<!DOCTYPE html>
<!-- 
    Statistics page for SpyGame - shows game history and performance metrics
    This page follows the same structure as index.html but displays different content
-->
<html lang="en">
<head>
    <!-- Same metadata setup as the main page -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpyGame - Statistics</title>
    <!-- Different title to show this is the statistics page -->
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Uses the same CSS file as the main page for consistent styling -->
</head>
<body>
    <div class="container">
        <!-- Same container structure for consistent layout -->
        
        <header>
            <!-- Header section with statistics-specific content -->
            <h1>üïµÔ∏è SpyGame Statistics</h1>
            <!-- Main heading indicating this is the statistics page -->
            
            {% if current_user != 'guest' %}
                <p>Game history for {{ current_user }}</p>
                <!-- Personalized subtitle for logged-in users -->
            {% else %}
                <p>Guest game history (this session only)</p>
                <!-- Different subtitle for guest users -->
            {% endif %}
        </header>

        <main>
            <!-- Main content area for statistics -->
            
            <div class="stats-nav">
                <!-- Navigation section to return to the main game -->
                <a href="/" class="btn btn-primary">‚Üê Back to Game</a>
                <!-- Link back to the main page (/) with arrow indicating direction -->
            </div>

            <div class="stats-content">
                <!-- Main statistics content area -->
                
                {% if sessions %}
                <!-- 
                    Flask template conditional: Only show statistics if there are game sessions
                    sessions is a variable passed from the Flask server containing game data
                    The if sessions statement checks if the sessions list has any data
                -->
                
                    <div class="stats-summary">
                        <!-- Summary section showing key metrics -->
                        <h3>Game Summary</h3>
                        <!-- Section heading -->
                        
                        <div class="summary-cards">
                            <!-- 
                                Container for summary cards using CSS Grid layout
                                This creates responsive cards that show key statistics
                            -->
                            
                            <div class="summary-card">
                                <!-- Card showing total number of games played -->
                                <h4>Total Games</h4>
                                <p class="stat-number">{{ sessions|length }}</p>
                                <!-- 
                                    {{ sessions|length }} uses Flask's Jinja2 template syntax
                                    |length is a "filter" that counts items in the sessions list
                                -->
                            </div>
                            
                            <div class="summary-card">
                                <!-- Card showing successful guesses -->
                                <h4>Correct Guesses</h4>
                                <p class="stat-number">{{ sessions|selectattr('acierto', 'equalto', true)|list|length }}</p>
                                <!-- 
                                    This template expression:
                                    1. Filters sessions to only those where 'acierto' equals true
                                    2. Converts the result to a list and gets the length (count)
                                -->
                            </div>
                            
                            <div class="summary-card">
                                <!-- Card showing success percentage -->
                                <h4>Success Rate</h4>
                                <p class="stat-number">
                                    {% set correct_guesses = sessions|selectattr('acierto', 'equalto', true)|list|length %}
                                    {% set total_games = sessions|length %}
                                    <!-- 
                                        Set variables for calculation:
                                        - correct_guesses: Count of sessions where acierto=true
                                        - total_games: Total number of game sessions
                                    -->
                                    {% if total_games > 0 %}
                                        {{ "%.1f"|format((correct_guesses / total_games) * 100) }}%
                                        <!-- Calculate percentage and format to 1 decimal place -->
                                    {% else %}
                                        0%
                                        <!-- Show 0% if no games have been played -->
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="sessions-table">
                        <!-- Table section showing detailed game history -->
                        <h3>Game History</h3>
                        <!-- Section heading for the detailed history table -->
                        
                        <table>
                            <!-- 
                                HTML table element for displaying structured data
                                Tables have rows and columns, perfect for showing game records
                            -->
                            
                            <thead>
                                <!-- 
                                    Table header section - defines column titles
                                    <thead> groups header content separate from data rows
                                -->
                                <tr>
                                    <!-- Table row containing header cells -->
                                    <th>Date & Time</th>        <!-- Column for when game started -->
                                    <th>Person</th>             <!-- Column for which historical figure -->
                                    <th>Hints Used</th>         <!-- Column for number of hints requested -->
                                    <th>Hints</th>              <!-- Column for list of hints -->
                                    <th>Guesses</th>            <!-- Column for list of guesses -->
                                    <th>Result</th>             <!-- Column for outcome (correct/wrong) -->
                                </tr>
                            </thead>
                            
                            <tbody>
                                <!-- 
                                    Table body section - contains the actual data rows
                                    <tbody> groups data content separate from headers
                                -->
                                
                                {% for session in sessions|reverse %}
                                <!-- 
                                    Flask template loop: Iterate through each session in reverse order
                                    |reverse filter shows newest sessions first
                                -->
                                
                                <tr>
                                    <!-- Table row for each game session -->
                                    
                                    <td>{{ session.timestamp[:19]|replace('T', ' ') }}</td>
                                    <!-- 
                                        Display date/time of the session
                                        [:19] takes first 19 characters (removes milliseconds)
                                        |replace('T', ' ') changes 'T' to space for better readability
                                        Example: "2025-09-15T14:27:35" becomes "2025-09-15 14:27:35"
                                    -->
                                    
                                    <td>{{ session.person }}</td>
                                    <!-- Display which historical person this session was about -->
                                    
                                    <td>{{ session.pista|length }}</td>
                                    <!-- Display the number of hints used in this game -->
                                    
                                    <td>
                                        <!-- Show all hints used in this game -->
                                        <ul style="margin: 0; padding-left: 20px; text-align: left;">
                                            {% for hint in session.pista %}
                                                <li>{{ hint }}</li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                    
                                    <td>
                                        <!-- Show all guesses made in this game -->
                                        {% if session.guesses %}
                                            <ul style="margin: 0; padding-left: 20px; text-align: left;">
                                                {% for guess in session.guesses %}
                                                    <li>{{ guess }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% else %}
                                            <span style="color: #888;">No guesses</span>
                                        {% endif %}
                                    </td>
                                    
                                    <td>
                                        <!-- Show the result/outcome with appropriate styling -->
                                        {% if session.acierto == true %}
                                            <span class="result-correct">‚úì Correct</span>
                                            <!-- Green styling for correct guesses -->
                                        {% else %}
                                            <span class="result-incorrect">‚úó Wrong</span>
                                            <!-- Red styling for incorrect guesses or gave up -->
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                <!-- End of session loop -->
                            </tbody>
                        </table>
                    </div>
                {% else %}
                <!-- 
                    This section displays when there are no game sessions yet
                    else is the alternative to if sessions
                -->
                
                    <div class="no-data">
                        <!-- Container for the "no data" message -->
                        <h3>No Game History</h3>
                        <!-- Heading indicating no games have been played -->
                        
                        <p>You haven't played any games yet. <a href="/">Start your first game!</a></p>
                        <!-- 
                            Encouraging message with a link back to the main game page
                            <a href="/"> creates a link to the root page (main game)
                        -->
                    </div>
                {% endif %}
                <!-- End of conditional content -->
            </div>
            <!-- End of stats content area -->
        </main>
        <!-- End of main content area -->
    </div>
    <!-- End of container -->
</body>
<!-- End of HTML body -->
</html>
<!-- End of HTML document -->